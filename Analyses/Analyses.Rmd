---
title: "Analyses"
author: "Vera Weisbecker and Cruise Speck"
date: "5 December 2018"
output: html_document
---



## load required packages and processed data



```{r }
library(ape)
library(geiger)
library(caper)
library(car)
library(multcomp)
library(geomorph)
library(lmSupport)
library(ggplot2)
library(nlme)

#the "utilities" file contains functions so this analysis page isn't too cluttered
source("../Analyses/Utilities.r")
load(file = "../Data/Processed_Data_for_Pgls.rda")



```

#is there a difference in tail/body length relationships between the sexes or if we use maximum tail length?

```{r}
#Marsupials:

  ##Re-arrange datasets to put males, femals and averages under each other, turning into a data frame for column names
  
  Males<-cbind(marsFull$Tl_Av_M,marsFull$Bl_Av_M,marsFull$Wt_Av_M, marsFull$Locomotor_use,rep(1,length(marsFull$Tl_Av_M)))
  Females<-cbind(marsFull$Tl_Av_F,marsFull$Bl_Av_F,marsFull$Wt_Av_F,marsFull$Locomotor_use, rep(2,length(marsFull$Tl_Av_F)))
  Averages<-cbind(marsFull$Tl_mm, marsFull$Bl_mm,marsFull$Wt_g, marsFull$Locomotor_use,rep(3,length(marsFull$Bl_mm)))
  
  Combine=rbind(Males, Females,Averages)
  Combine=as.data.frame(Combine)
  colnames(Combine) <-c("Tl","Bl","Wt","Locomotor_use","Sex")
  Combine$Sex<-as.factor(Combine$Sex)
  Combine$Locomotor_use<-as.factor(Combine$Locomotor_use)
  
  ##Are there differences in slope of Tail length and body LENGTH according to locomotor use, sex, or averages between sexes?
  Sex_locomotion=summary(lm(Combine$Tl~Combine$Bl*Combine$Sex*Combine$Locomotor_use))
  Sex_locomotion=aov (Combine$Tl~Combine$Bl*Combine$Sex*Combine$Locomotor_use)
  
  ##If significant interactions, use
  testInteractions(Sex_locomotion)
  #if not, re-run without interactions; if any intercept is significant, run something like the below
  TukeyHSD(MaleFemaleaov,which='Sex', data=Combine )
  
  ##Are there differences in slope of Tail length and body WEIGHT according to locomotor use, sex, or averages between sexes?
  Sex_locomotion=summary(lm(Combine$Tl~Combine$Wt *Combine$Sex*Combine$Locomotor_use))
  Sex_locomotion=aov (Combine$Tl~Combine$Wt*Combine$Sex*Combine$Locomotor_use)
  
  ##If significant interactions, use
  testInteractions(Sex_locomotion)
  #if not, re-run without interactions; if any intercept is significant, run something like the below
  TukeyHSD(MaleFemaleaov,which='Sex', data=Combine )

#Rodents:

  Males<-cbind(rodFull$Tl_Av_M,rodFull$Bl_Av_M,rodFull$Wt_Av_M, rodFull$Locomotor_use,rep(1,length(rodFull$Tl_Av_M)))
  Females<-cbind(rodFull$Tl_Av_F,rodFull$Bl_Av_F,rodFull$Wt_Av_F,rodFull$Locomotor_use, rep(2,length(rodFull$Tl_Av_F)))
  Averages<-cbind(rodFull$Tl_mm, rodFull$Bl_mm,rodFull$Wt_g, rodFull$Locomotor_use,rep(3,length(rodFull$Bl_mm)))
  
  Combine=rbind(Males, Females,Averages)
  Combine=as.data.frame(Combine)
  colnames(Combine) <-c("Tl","Bl","Wt","Locomotor_use","Sex")
  Combine$Sex<-as.factor(Combine$Sex)
  Combine$Locomotor_use<-as.factor(Combine$Locomotor_use)
  
  #Are there differences in slope of Tail length and body LENGTH according to locomotor use, sex, or averages between sexes?
  Sex_locomotion=summary(lm(Combine$Tl~Combine$Bl*Combine$Sex*Combine$Locomotor_use))
  Sex_locomotion=aov (Combine$Tl~Combine$Bl*Combine$Sex*Combine$Locomotor_use)
  
  #If significant interactions, use
  testInteractions(Sex_locomotion)
  #if not, re-run without interactions; if any intercept is significant, run something like the below
  TukeyHSD(MaleFemaleaov,which='Sex', data=Combine )
  
  #Are there differences in slope of Tail length and body WEIGHT according to locomotor use, sex, or averages between sexes?
  Sex_locomotion=summary(lm(Combine$Tl~Combine$Wt *Combine$Sex*Combine$Locomotor_use))
  Sex_locomotion=aov (Combine$Tl~Combine$Wt*Combine$Sex*Combine$Locomotor_use)
  
  #If significant interactions, use
  testInteractions(Sex_locomotion)
  #if not, re-run without interactions; if any intercept is significant, run something like the below
  TukeyHSD(MaleFemaleaov,which='Sex', data=Combine )


```

# Do Tail lengths scale differently compared to body lengths/weights in species with different locomotor modes?

```{r}

#Marsupials
    
  ##Tail vs body LENGTH
    TB=find.best.model(Tl~Bl*Locomotor_use,marsTree,mars);TB$AIC_Weights
     
    ###look at the model summary of the most likely model, e.g. 
    TB$Model_summaries$corBrownian$tTable
      
    ###using the smaller, m/f specific datasets
    TB=find.best.model(Tl_Av_F ~Bl_Av_F*Locomotor_use,marsTree, mf_mars);TB$AIC_Weights
    TB$Model_summaries$corBrownian$tTable
      
    TB=find.best.model(Tl_Av_M~Wt_Av_M*Locomotor_use,marsTree,mf_mars);TB$AIC_Weights
    TB$Model_summaries$corBrownian$tTable
  
  ##Tail vs body WEIGHT
    TW=find.best.model(Tl~Wt*Locomotor_use,marsTree,mars);TW$AIC_Weights
     
    ###look at the model summary of the most likely model, e.g. 
    TW$Model_summaries$corBrownian$tTable
      
    ###using the smaller, m/f specific datasets
    TW=find.best.model(Tl_Av_F ~Wt_Av_F*Locomotor_use,marsTree, mf_mars);TW$AIC_Weights
    TW$Model_summaries$corBrownian$tTable
      
    TW=find.best.model(Tl_Av_M~Wt_Av_M*Locomotor_use,marsTree,mf_mars);TW$AIC_Weights
    TW$Model_summaries$corBrownian$tTable
  
    
#Rodents
    
  ##Tail vs body LENGTH
    TB=find.best.model(Tl~Bl*Locomotor_use,rodTree,rod);TB$AIC_Weights
    TB$Model_summaries$corBrownian$tTable
      
    ###using the smaller, m/f specific datasets
    TB=find.best.model(Tl_Av_F ~Bl_Av_F*Locomotor_use,rodTree, mf_rod);TB$AIC_Weights
    TB$Model_summaries$corBrownian$tTable
      
    TB=find.best.model(Tl_Av_M~Wt_Av_M*Locomotor_use,rodTree,mf_rod);TB$AIC_Weights
    TB$Model_summaries$corBrownian$tTable
      
  ##Tail vs body WEIGHT
    TW=find.best.model(Tl~Wt*Locomotor_use,rodTree,rod);TW$AIC_Weights
     
    ###look at the model summary of the most likely model, e.g. 
    TW$Model_summaries$corBrownian$tTable
      
    ###using the smaller, m/f specific datasets
    TW=find.best.model(Tl_Av_F ~Wt_Av_F*Locomotor_use,rodTree, mf_rod);TW$AIC_Weights
    TW$Model_summaries$corBrownian$tTable
      
    TW=find.best.model(Tl_Av_M~Wt_Av_M*Locomotor_use,rodTree,mf_rod);TW$AIC_Weights
    TW$Model_summaries$corBrownian$tTable
   
```

#Plotting bits

```{r}
  
#plot male-only, female-only, and averaged datasets together

plot(mars_sexes$Bl_M,mars_sexes$Tl_M, col="red", pch=19);points(mars_sexes$Bl_F,mars_sexes$Tl_F, col="blue", pch=19);points(mars$Blength_mm,mars$Tlength_mm, col="green", pch=19);points(mars$Tl_max~mars$Bl_max, col="pink", pch=19);abline(lm(mars_sexes$Tl_M~mars_sexes$Bl_M), col="red");abline(lm(mars_sexes$Tl_F~mars_sexes$Bl_F), col="blue"); abline(lm(mars$Tlength_mm~mars$Blength_mm), col="green"); abline(lm(mars$Tl_max~mars$Bl_max), col="pink")


```

